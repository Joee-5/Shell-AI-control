#!/usr/bin/env python3
import rclpy
from rclpy.node import Node
from nav_msgs.msg import Path
from geometry_msgs.msg import PoseStamped

# ==============================================================================
# 1. ACTUAL TRACK GEOMETRY POINTS (Your Data)
# ==============================================================================
TRACK_POINTS = [
    (-4.558597, 0.061121, 0.499973), (-2.401001, 0.042202, 0.499973), (0.940216, -0.007674, 0.499973),
    (5.217319, -0.078189, 0.499973), (10.182570, -0.159023, 0.499973), (15.588230, -0.239857, 0.499973),
    (21.186570, -0.310372, 0.499973), (26.729850, -0.360249, 0.499973), (31.970330, -0.379167, 0.499973),
    (36.660270, -0.356809, 0.499973), (40.551940, -0.282854, 0.499973), (43.397610, -0.146984, 0.499973),
    (44.949540, 0.061121, 0.499973), (48.371120, 1.775234, 0.499973), (50.573340, 4.342968, 0.499973),
    (51.790450, 7.614625, 0.499973), (52.256690, 11.440510, 0.499973), (52.206320, 15.670930, 0.499973),
    (51.873580, 20.156180, 0.499973), (51.492710, 24.746570, 0.499973), (51.297960, 29.292400, 0.499973),
    (51.523590, 33.643980, 0.499973), (52.403840, 37.651620, 0.499973), (54.172950, 41.165610, 0.499973),
    (57.065190, 44.036260, 0.499973), (58.588940, 45.150300, 0.499973), (60.219150, 46.463640, 0.499973),
    (61.849460, 47.979430, 0.499973), (63.373530, 49.700790, 0.499973), (64.684990, 51.630850, 0.499973),
    (65.677500, 53.772740, 0.499973), (66.244700, 56.129590, 0.499973), (66.280230, 58.704530, 0.499973),
    (65.677740, 61.500680, 0.499973), (64.330880, 64.521180, 0.499973), (62.133290, 67.769160, 0.499973),
    (58.978620, 71.247740, 0.499973), (58.105520, 72.017050, 0.499973), (57.020180, 72.847820, 0.499973),
    (55.766970, 73.735570, 0.499973), (54.390240, 74.675800, 0.499973), (52.934360, 75.664020, 0.499973),
    (51.443690, 76.695730, 0.499973), (49.962600, 77.766460, 0.499973), (48.535430, 78.871700, 0.499973),
    (47.206560, 80.006970, 0.499973), (46.020350, 81.167770, 0.499973), (45.021150, 82.349600, 0.499973),
    (44.253330, 83.547990, 0.499973), (42.907030, 87.279320, 0.499973), (42.668370, 91.006780, 0.499973),
    (43.314670, 94.730510, 0.499973), (44.623250, 98.450680, 0.499973), (46.371440, 102.167400, 0.499973),
    (48.336570, 105.880900, 0.499973), (50.295950, 109.591300, 0.499973), (52.026910, 113.298700, 0.499973),
    (53.306780, 117.003400, 0.499973), (53.912870, 120.705400, 0.499973), (53.622530, 124.404900, 0.499973),
    (52.213060, 128.102000, 0.499973), (48.753910, 131.925400, 0.499973), (43.325930, 134.934000, 0.499973),
    (36.315110, 137.167000, 0.499973), (28.107460, 138.663700, 0.499973), (19.088980, 139.463300, 0.499973),
    (9.645670, 139.605100, 0.499973), (0.163531, 139.128300, 0.499973), (-8.971436, 138.072100, 0.499973),
    (-17.373230, 136.475700, 0.499973), (-24.655850, 134.378500, 0.499973), (-30.433300, 131.819600, 0.499973),
    (-34.319550, 128.838200, 0.499973), (-35.354930, 127.758600, 0.499973), (-36.603500, 126.550800, 0.499973),
    (-38.003830, 125.180900, 0.499973), (-39.494450, 123.614800, 0.499973), (-41.013910, 121.818600, 0.499973),
    (-42.500770, 119.758100, 0.499973), (-43.893570, 117.399300, 0.499973), (-45.130860, 114.708300, 0.499973),
    (-46.151190, 111.650900, 0.499973), (-46.893100, 108.193200, 0.499973), (-47.295150, 104.301000, 0.499973),
    (-47.295890, 99.940460, 0.499973), (-47.208960, 97.567750, 0.499973), (-47.152200, 94.814460, 0.499973),
    (-47.121310, 91.741730, 0.499973), (-47.111970, 88.410750, 0.499973), (-47.119870, 84.882650, 0.499973),
    (-47.140710, 81.218620, 0.499973), (-47.170160, 77.479810, 0.499973), (-47.203930, 73.727380, 0.499973),
    (-47.237700, 70.022490, 0.499973), (-47.267160, 66.426320, 0.499973), (-47.287990, 63.000000, 0.499973),
    (-47.295890, 59.804710, 0.499973), (-47.295890, 59.185450, 0.499973), (-47.295890, 58.566190, 0.499973),
    (-47.295890, 57.946930, 0.499973), (-47.295890, 57.327670, 0.499973), (-47.295890, 56.708410, 0.499973),
    (-47.295890, 56.089160, 0.499973), (-47.295890, 55.469900, 0.499973), (-47.295890, 54.850640, 0.499973),
    (-47.295890, 54.231380, 0.499973), (-47.295890, 53.612120, 0.499973), (-47.295890, 52.992860, 0.499973),
    (-47.295890, 52.373600, 0.499973), (-47.295890, 49.544990, 0.499973), (-47.295890, 47.392780, 0.499973),
    (-47.295890, 45.810130, 0.499973), (-47.295890, 44.690160, 0.499973), (-47.295890, 43.926020, 0.499973),
    (-47.295890, 43.410850, 0.499973), (-47.295890, 43.037780, 0.499973), (-47.295890, 42.699950, 0.499973),
    (-47.295890, 42.290500, 0.499973), (-47.295890, 41.702580, 0.499973), (-47.295890, 40.829310, 0.499973),
    (-47.295890, 39.563840, 0.499973), (-47.295890, 38.104780, 0.499973), (-47.295890, 36.728210, 0.499973),
    (-47.295890, 35.438450, 0.499973), (-47.295890, 34.239810, 0.499973), (-47.295890, 33.136600, 0.499973),
    (-47.295890, 32.133150, 0.499973), (-47.295890, 31.233780, 0.499973), (-47.295890, 30.442790, 0.499973),
    (-47.295890, 29.764510, 0.499973), (-47.295890, 29.203250, 0.499973), (-47.295890, 28.763330, 0.499973),
    (-47.295890, 28.449060, 0.499973), (-46.987900, 20.854450, 0.499973), (-46.121770, 14.716410, 0.499973),
    (-44.784220, 9.883191, 0.499973), (-43.062000, 6.203030, 0.499973), (-41.041830, 3.524173, 0.499973),
    (-38.810450, 1.694863, 0.499973), (-36.454600, 0.563344, 0.499973), (-34.061010, -0.022142, 0.499973),
    (-31.716420, -0.213351, 0.499973), (-29.507560, -0.162040, 0.499973), (-27.521170, -0.019965, 0.499973),
    (-25.843980, 0.061121, 0.499973), (-23.584080, 0.061121, 0.499973), (-21.374230, 0.061121, 0.499973),
    (-19.225930, 0.061121, 0.499973), (-17.150680, 0.061121, 0.499973), (-15.159980, 0.061121, 0.499973),
    (-13.265340, 0.061121, 0.499973), (-11.478250, 0.061121, 0.499973), (-9.810216, 0.061121, 0.499973),
    (-8.272733, 0.061121, 0.499973), (-6.877303, 0.061121, 0.499973), (-5.635426, 0.061121, 0.499973)
]

class PathGenerator(Node):
    def __init__(self):
        super().__init__('PathGenerator')
        self.get_logger().info('Path Generator Node Initialized')
        
        # NOTE: Using the standard integer 10 for QoS to match the working file
        self.pathPub = self.create_publisher(Path, '/path', 10)
        
        self.path = Path()
        self.generatePath()
        
        # Timer set to 0.1 to match working file (snappy updates)
        self.timer = self.create_timer(0.1, self.publishPath)
        
    def generatePath(self):
        self.path.header.frame_id = "map"
        self.path.header.stamp = self.get_clock().now().to_msg()
        
        for point in TRACK_POINTS:
            pose = PoseStamped()
            pose.pose.position.x = point[0]
            pose.pose.position.y = point[1]
            # Use the Z from the data or default to 0.5 (Z_LIFT) if you prefer
            pose.pose.position.z = point[2] 
            self.path.poses.append(pose)
        
    def publishPath(self):
        self.path.header.stamp = self.get_clock().now().to_msg()
        self.pathPub.publish(self.path)

def main(args=None):
    rclpy.init(args=args)
    pathGen = PathGenerator()
    rclpy.spin(pathGen)
    pathGen.destroy_node()
    rclpy.shutdown()